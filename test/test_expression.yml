- name: test-expression-dry-run-single
  tags:
    - dry-run
  command: >
    snakemake -n
    --snakefile includes/expression/Snakefile
    --configfile test/data/config/test-dry-run-single.config
  stdout:
    contains:
      - "Job counts:"
      - "TestSample/expression/TestSample.bases_per_exon"
      - "TestSample/expression/TestSample.bases_per_gene"
      - "TestSample/expression/TestSample.exon_ratios"
      - "TestSample/expression/TestSample.fragments_per_gene"
      - "TestSample/expression/TestSample.raw_base"

- name: test-expression-dry-run-trio
  tags:
    - dry-run
  command: >
    snakemake -n
    --snakefile includes/expression/Snakefile
    --configfile test/data/config/test-dry-run-trio.config
  stdout:
    contains:
      - "Job counts:"
      - "TestSample1/expression/TestSample1.bases_per_exon"
      - "TestSample1/expression/TestSample1.bases_per_gene"
      - "TestSample1/expression/TestSample1.exon_ratios"
      - "TestSample1/expression/TestSample1.fragments_per_gene"
      - "TestSample1/expression/TestSample1.raw_base"
      - "TestSample2/expression/TestSample2.bases_per_exon"
      - "TestSample2/expression/TestSample2.bases_per_gene"
      - "TestSample2/expression/TestSample2.exon_ratios"
      - "TestSample2/expression/TestSample2.fragments_per_gene"
      - "TestSample2/expression/TestSample2.raw_base"
      - "TestSample3/expression/TestSample3.bases_per_exon"
      - "TestSample3/expression/TestSample3.bases_per_gene"
      - "TestSample3/expression/TestSample3.exon_ratios"
      - "TestSample3/expression/TestSample3.fragments_per_gene"
      - "TestSample3/expression/TestSample3.raw_base"

- name: test-expression-sanity-snakemake
  tags:
    - sanity
  command: >
    snakemake --version
  stdout:
    contains:
      - "5.9"

- name: test-expression-sanity-singularity
  tags:
    - sanity
  command: >
    singularity --version
  stdout:
    contains:
      - "singularity version 3.1"

- name: test-expression-sanity-rattle
  tags:
    - sanity
  command: >
    python -m rattle

- name: test-expression-integration-HEL
  tags:
    - integration
  command: >
    snakemake -rp
    --snakefile includes/expression/Snakefile
    --configfile test/data/config/test-expression-HEL.config
    --cluster-config test/data/config/cluster-config.yml
    --verbose
    --use-singularity
    --singularity-args ' --containall --bind /exports'
    --singularity-prefix /exports/hem-leukemia/testing/singularity
    --drmaa ' -pe BWA {cluster.threads} -q all.q -l h_vmem={cluster.vmem} -cwd -V -N hamlet-test '
    --drmaa-log-dir cluster-logs
    --jobname 'hamlet.{jobid}'
    --jobs 70
    --latency-wait 120
  files:
    - path: "HEL/expression/HEL.fragments_per_gene"
      contains:
        - "MECOM\t3677"
        - "HMBS\t9154"
