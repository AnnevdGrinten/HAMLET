- name: test-fusion-dry-run-single
  tags:
    - dry-run
    - fusion
  command: >
    snakemake -n
    --snakefile includes/fusion/Snakefile
    --configfile test/data/config/test-dry-run-single.config
  stdout:
    contains:
      - "Job counts:"
      - "TestSample/fusion/TestSample.star-fusion"
      - "TestSample/fusion/TestSample.star-fusion-circos/fsnviz.svg"
      - "TestSample/fusion/TestSample.star-fusion-circos/fsnviz.png"
      - "TestSample/fusion/star-fusion/star-fusion.fusion_predictions.tsv"
      - "TestSample/fusion/fusioncatcher/final-list_candidate-fusion-genes.txt"
      - "TestSample/fusion/TestSample.fusioncatcher"
      - "TestSample/fusion/TestSample.fusioncatcher-circos/fsnviz.png"
      - "TestSample/fusion/TestSample.fuma"
      - "TestSample/fusion/TestSample.sf-isect"
      - "TestSample/fusion/TestSample.sf-isect-circos/fsnviz.svg"
      - "TestSample/fusion/TestSample.fusions-combined.svg"

- name: test-fusion-dry-run-trio
  tags:
    - dry-run
    - fusion
  command: >
    snakemake -n
    --snakefile includes/fusion/Snakefile
    --configfile test/data/config/test-dry-run-trio.config
  stdout:
    contains:
      - "Job counts:"
      - "TestSample1/fusion/TestSample1.star-fusion"
      - "TestSample1/fusion/TestSample1.star-fusion-circos/fsnviz.svg"
      - "TestSample1/fusion/TestSample1.star-fusion-circos/fsnviz.png"
      - "TestSample1/fusion/star-fusion/star-fusion.fusion_predictions.tsv"
      - "TestSample1/fusion/fusioncatcher/final-list_candidate-fusion-genes.txt"
      - "TestSample1/fusion/TestSample1.fusioncatcher"
      - "TestSample1/fusion/TestSample1.fusioncatcher-circos/fsnviz.png"
      - "TestSample1/fusion/TestSample1.fuma"
      - "TestSample1/fusion/TestSample1.sf-isect"
      - "TestSample1/fusion/TestSample1.sf-isect-circos/fsnviz.svg"
      - "TestSample1/fusion/TestSample1.fusions-combined.svg"

      - "TestSample2/fusion/TestSample2.star-fusion"
      - "TestSample2/fusion/TestSample2.star-fusion-circos/fsnviz.svg"
      - "TestSample2/fusion/TestSample2.star-fusion-circos/fsnviz.png"
      - "TestSample2/fusion/star-fusion/star-fusion.fusion_predictions.tsv"
      - "TestSample2/fusion/fusioncatcher/final-list_candidate-fusion-genes.txt"
      - "TestSample2/fusion/TestSample2.fusioncatcher"
      - "TestSample2/fusion/TestSample2.fusioncatcher-circos/fsnviz.png"
      - "TestSample2/fusion/TestSample2.fuma"
      - "TestSample2/fusion/TestSample2.sf-isect"
      - "TestSample2/fusion/TestSample2.sf-isect-circos/fsnviz.svg"
      - "TestSample2/fusion/TestSample2.fusions-combined.svg"

      - "TestSample3/fusion/TestSample3.star-fusion"
      - "TestSample3/fusion/TestSample3.star-fusion-circos/fsnviz.svg"
      - "TestSample3/fusion/TestSample3.star-fusion-circos/fsnviz.png"
      - "TestSample3/fusion/star-fusion/star-fusion.fusion_predictions.tsv"
      - "TestSample3/fusion/fusioncatcher/final-list_candidate-fusion-genes.txt"
      - "TestSample3/fusion/TestSample3.fusioncatcher"
      - "TestSample3/fusion/TestSample3.fusioncatcher-circos/fsnviz.png"
      - "TestSample3/fusion/TestSample3.fuma"
      - "TestSample3/fusion/TestSample3.sf-isect"
      - "TestSample3/fusion/TestSample3.sf-isect-circos/fsnviz.svg"
      - "TestSample3/fusion/TestSample3.fusions-combined.svg"

- name: test-fusion-sanity-singularity
  tags:
    - sanity
    - fusion
  command: >
    singularity --version
  stdout:
    contains_regex:
      - "singularity(-ce)? version 3"

- name: test-fusion-chrM
  tags:
    - functional
    - fusion
  command: >
    snakemake -rp
    --configfile test/data/config/test-chrM-fusion.config
    --cores 1
    --notemp
    --verbose
    --use-singularity
    --singularity-args '--cleanenv --bind /tmp'
  files:
    - path: chrM-fusion/fusion/star-fusion/star-fusion.fusion_predictions.tsv
    - path: chrM-fusion/fusion/chrM-fusion.star-fusion
