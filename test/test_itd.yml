- name: test-itd-dry-run-single
  tags:
    - dry-run
  command: >
    snakemake -n
    --snakefile includes/itd/Snakefile
    --configfile test/data/config/test-dry-run-single.config
  stdout:
    contains:
      - "Job counts:"
      - "TestSample/itd/TestSample.kmt2a.csv"
      - "TestSample/itd/TestSample.kmt2a.bg.csv"
      - "TestSample/itd/TestSample.kmt2a.png"
      - "TestSample/itd/TestSample.flt3.csv"
      - "TestSample/itd/TestSample.flt3.bg.csv"
      - "TestSample/itd/TestSample.flt3.png"

- name: test-itd-dry-run-trio
  tags:
    - dry-run
  command: >
    snakemake -n
    --snakefile includes/itd/Snakefile
    --configfile test/data/config/test-dry-run-trio.config
  stdout:
    contains:
      - "Job counts:"
      - "TestSample1/itd/TestSample1.kmt2a.csv"
      - "TestSample1/itd/TestSample1.kmt2a.bg.csv"
      - "TestSample1/itd/TestSample1.kmt2a.png"
      - "TestSample1/itd/TestSample1.flt3.csv"
      - "TestSample1/itd/TestSample1.flt3.bg.csv"
      - "TestSample1/itd/TestSample1.flt3.png"
      - "TestSample2/itd/TestSample2.kmt2a.csv"
      - "TestSample2/itd/TestSample2.kmt2a.bg.csv"
      - "TestSample2/itd/TestSample2.kmt2a.png"
      - "TestSample2/itd/TestSample2.flt3.csv"
      - "TestSample2/itd/TestSample2.flt3.bg.csv"
      - "TestSample2/itd/TestSample2.flt3.png"
      - "TestSample3/itd/TestSample3.kmt2a.csv"
      - "TestSample3/itd/TestSample3.kmt2a.bg.csv"
      - "TestSample3/itd/TestSample3.kmt2a.png"
      - "TestSample3/itd/TestSample3.flt3.csv"
      - "TestSample3/itd/TestSample3.flt3.bg.csv"
      - "TestSample3/itd/TestSample3.flt3.png"

- name: test-itd-sanity-snakemake
  tags:
    - sanity
  command: >
    snakemake --version
  stdout:
    contains:
      - "5.9"

- name: test-itd-sanity-singularity
  tags:
    - sanity
  command: >
    singularity --version
  stdout:
    contains:
      - "singularity version 3.1"

- name: test-itd-MV4-11-flt3
  tags:
    - integration
  command: >
      snakemake -rp
      --use-singularity
      --singularity-args ' --containall --bind /tmp/:/tmp,/exports/:/exports/'
      --singularity-prefix /exports/hem-leukemia/testing/singularity
      --snakefile includes/itd/Snakefile
      --configfile test/data/config/test-itd-MV4-11.config
      --verbose
      MV4-11/itd/MV4-11.flt3.csv
      MV4-11/itd/MV4-11.flt3.png
  files:
    - path: "MV4-11/itd/MV4-11.flt3.bg.csv"
      contains:
        - "position\tcoverage\tsoft_clip_count"
          #- "1852\t1749\t570"
          #- "1883\t1775\t1094"
    - path: "MV4-11/itd/MV4-11.flt3.csv"
      contains:
        - "td_starts\ttd_ends\trose_start_count\trose_end_count\trose_start_pos\trose_start_anchor_pos\trose_end_pos\trose_end_anchor_pos\tboundary_type\tfuzziness"
          #- "1853\t1882\t563\t1091\t1852\t1882\t1883\t1853\texact\t0"
    - path: "MV4-11/itd/MV4-11.flt3.png"
